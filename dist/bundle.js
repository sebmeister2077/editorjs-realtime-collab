!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RealtimeCollabPlugin=t():e.RealtimeCollabPlugin=t()}(self,(()=>(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},c=[],l=0;l<e.length;l++){var a=e[l],s=o.base?a[0]+o.base:a[0],d=r[s]||0,u="".concat(s," ").concat(d);r[s]=d+1;var v=n(u),f={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==v)t[v].references++,t[v].updater(f);else{var h=i(f,o);o.byIndex=l,t.splice(l,0,{identifier:u,updater:h,references:1})}c.push(u)}return c}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var c=0;c<r.length;c++){var l=n(r[c]);t[l].references--}for(var a=o(e,i),s=0;s<r.length;s++){var d=n(r[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=a}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var c={};if(o)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(c[a]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&c[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},523:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),r=n(314),c=n.n(r)()(i());c.push([e.id,".codex-editor__redactor {\n    position: relative;\n}\n\n.cdx-realtime-block--selected .ce-block__content {\n    position: relative;\n}\n\n.cdx-realtime-block--selected:not(.ce-block--drop-target) .ce-block__content::before {\n    content: '';\n    position: absolute;\n    inset: 0px;\n    z-index: -1;\n    background-color: #e1f2ff99;\n}\n\n.cdx-realtime-block--delete-pending .ce-block__content::before {\n    content: '';\n    position: absolute;\n    inset: 0px;\n    z-index: -1;\n    background-color: #E24A4A;\n}\n\n.cdx-realtime-block--selected .ce-block__content [contenteditable] {\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\n.cdx-realtime-block--selected .ce-block__content img,\n.cdx-realtime-block--selected .ce-block__content .ce-stub {\n    opacity: 0.55;\n}\n\n.cdx-realtime-inline-cursor {\n    position: absolute;\n    background-color: var(--realtime-inline-cursor-color, #0d0c0f);\n    width: 1px;\n    height: 1ch;\n    animation: cursor-blink 0.6s 1s infinite alternate ease-in-out;\n    -webkit-animation: cursor-blink 0.6s 1s infinite alternate ease-in-out;\n}\n\n\n@keyframes cursor-blink {\n\n    0%,\n    30% {\n        background-color: var(--realtime-inline-cursor-color, #0d0c0f);\n    }\n\n    100%,\n    70% {\n        background-color: transparent;\n    }\n}",""]);const l=c},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o={};function i(e,t,n){var o,i=n||{},r=i.noTrailing,c=void 0!==r&&r,l=i.noLeading,a=void 0!==l&&l,s=i.debounceMode,d=void 0===s?void 0:s,u=!1,v=0;function f(){o&&clearTimeout(o)}function h(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var l=this,s=Date.now()-v;function h(){v=Date.now(),t.apply(l,i)}function p(){o=void 0}u||(a||!d||o||h(),f(),void 0===d&&s>e?a?(v=Date.now(),c||(o=setTimeout(d?p:h,e))):h():!0!==c&&(o=setTimeout(d?p:h,void 0===d?e-s:e)))}return h.cancel=function(e){var t=(e||{}).upcomingOnly,n=void 0!==t&&t;f(),u=!n},h}n.d(o,{default:()=>B});var r=n(72),c=n.n(r),l=n(825),a=n.n(l),s=n(659),d=n.n(s),u=n(56),v=n.n(u),f=n(540),h=n.n(f),p=n(113),b=n.n(p),g=n(523),k={};k.styleTagTransform=b(),k.setAttributes=v(),k.insert=d().bind(null,"head"),k.domAPI=a(),k.insertStyleElement=h(),c()(g.A,k),g.A&&g.A.locals&&g.A.locals;var m=function(){return m=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},m.apply(this,arguments)},y=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function c(e){try{a(o.next(e))}catch(e){r(e)}}function l(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}a((o=o.apply(e,t||[])).next())}))},S=function(e,t){var n,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(c=0)),c;)try{if(n=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return c.label++,{value:l[1],done:!1};case 5:c.label++,o=l[1],l=[0];continue;case 7:l=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){c=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){c.label=l[1];break}if(6===l[0]&&c.label<i[1]){c.label=i[1],i=l;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(l);break}i[2]&&c.ops.pop(),c.trys.pop();continue}l=t.call(e,c)}catch(e){l=[6,e],o=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}},C=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n},I="block-selection-change",E="block-deletion-change",x="user-disconnected";const B=function(){function e(e){var t=this,n=e.editor,o=e.socket,i=e.socketMethodName,r=C(e,["editor","socket","socketMethodName"]);this.editorBlockEvent="block changed",this.editorDomChangedEvent="redactor dom changed",this._isListening=!1,this.ignoreEvents={},this.throttledBlockChange=void 0,this.throttledInlineSelectionChange=void 0,this.localBlockStates={},this.blockIdAttributeName="data-id",this.inlineFakeCursorAttributeName="data-realtime-fake-inline-cursor",this.inlineFakeSelectionAttributeName="data-realtime-fake-inline-selection",this.onInlineSelectionChange=function(e){var n=document.getSelection();if(n){var o=n.anchorNode;if(n.anchorOffset,n.focusOffset,o&&t.isNodeInsideOfEditor(o)){var i=o.parentElement;if(i){for(var r=[],c=n.getRangeAt(0).getClientRects(),l=0;l<c.length;l++){var a=c.item(l);a&&r.push(a)}var s=t.getContentAndBlockIdFromNode(o);if(s){var d=s.blockId,u=s.contentElement,v=u.getBoundingClientRect(),f=r.map((function(e){return{top:e.top-v.top,left:e.left-v.left,width:e.width}}));if(null!==t.getNodeRelativeChildIndex(o)){var h={type:"inline-selection-change",blockId:d,elementXPath:t.getElementXPath(i),containerWidth:u.clientWidth,rects:f,connectionId:t.socket.connectionId};t.socket.send(t.socketMethodName,h)}}}}}},this.onDisconnect=function(e){t.socket.send(t.socketMethodName,{type:x,connectionId:t.socket.connectionId})},this.onReceiveChange=function(e){var n,o,i,r,c,l,a,s,d;switch(e.type){case"block-added":var u=e.index,v=e.block;t.addBlockToIgnoreListUntilNextRender(v.id,e.type),t.editor.blocks.insert(v.tool,v.data,null,u,!1,!1,v.id);break;case"block-changed":var f=e.index,h=e.block;t.addBlockToIgnoreListUntilNextRender(h.id,e.type);var p=null===(o=t.getDOMBlockById(h.id))||void 0===o?void 0:o.classList;t.editor.blocks.update(h.id,h.data).catch((function(e){e.message==='Block with id "'.concat(h.id,'" not found')&&(t.addBlockToIgnoreListUntilNextRender(h.id,"block-added"),t.editor.blocks.insert(h.tool,h.data,null,f,!1,!1,h.id))})).then((function(){var e;if(null==p?void 0:p.contains(t.CSS.selected)){var n=t.getDOMBlockById(h.id);if(!n)return;n.classList.add(t.CSS.selected),(null===(e=t.config.overrideStyles)||void 0===e?void 0:e.selectedClass)&&n.classList.add(t.config.overrideStyles.selectedClass)}}));break;case"block-moved":var b=e.toBlockId,g=e.fromBlockId,k=e.toBlockIndex,m=t.editor.blocks.getBlockIndex(b),y=t.editor.blocks.getBlockIndex(g);if(k===y)return;t.addBlockToIgnoreListUntilNextRender(g,e.type),t.editor.blocks.move(m,y);break;case"block-removed":var S=e.blockId;t.addBlockToIgnoreListUntilNextRender(S,e.type);var C=t.editor.blocks.getBlockIndex(S);t.editor.blocks.delete(C);break;case"block-selection-change":S=e.blockId;var I=e.isSelected;if(t.addBlockToIgnoreListUntilNextRender(S,e.type),!(v=t.getDOMBlockById(S)))return;I?(v.classList.add(t.CSS.selected),(null===(i=t.config.overrideStyles)||void 0===i?void 0:i.selectedClass)&&v.classList.add(t.config.overrideStyles.selectedClass)):(v.classList.remove(t.CSS.selected),(null===(r=t.config.overrideStyles)||void 0===r?void 0:r.selectedClass)&&v.classList.remove(t.config.overrideStyles.selectedClass));break;case"block-deletion-change":S=e.blockId;var E=e.isDeletePending;if(t.addBlockToIgnoreListUntilNextRender(S,e.type),!(v=t.getDOMBlockById(S)))return;E?(v.classList.add(t.CSS.deletePending),(null===(c=t.config.overrideStyles)||void 0===c?void 0:c.pendingDeletionClass)&&v.classList.add(t.config.overrideStyles.pendingDeletionClass)):(v.classList.remove(t.CSS.deletePending),(null===(l=t.config.overrideStyles)||void 0===l?void 0:l.pendingDeletionClass)&&v.classList.remove(t.config.overrideStyles.pendingDeletionClass));break;case"inline-selection-change":e.type;var x=e.rects,B=e.elementXPath,L=(S=e.blockId,e.connectionId),N=null===(a=t.getDOMBlockById(S))||void 0===a?void 0:a.querySelector(".".concat(t.EditorCSS.blockContent));if(!N||!x.length)return;var w=x.some((function(e){return e.width>1})),T=null===B||w,A=t.getFakeCursor({connectionId:L}),M=Boolean(A);if(T)return void(null==A||A.remove());if(w);else{A?(A.style.animation="none",A.offsetHeight,A.style.animation=""):A=t.createFakeCursor(L);var O=x[0],R=document.querySelector(B);if(!(R instanceof HTMLElement))return;var D=window.getComputedStyle(R).fontSize;A.style.height=D,A.style.top="".concat(O.top,"px"),A.style.left="".concat(O.left,"px");var P=(null!==(s=t.config.overrideStyles)&&void 0!==s?s:{}).cursorClass,_=(null!==(d=t.config.cursor)&&void 0!==d?d:{}).color;_&&A.style.setProperty("--realtime-inline-cursor-color",_),P&&(n=A.classList).add.apply(n,P.split(" ")),M&&N.contains(A)||N.append(A)}break;case"user-disconnected":L=e.connectionId,A=t.getFakeCursor({connectionId:L}),t.getFakeSelections(),null==A||A.remove()}},this.onEditorBlockEvent=function(e){var n;if((null==e?void 0:e.event)instanceof CustomEvent&&e.event){var o=e.event;if(t.validateEventDetail(o)){var i=o.type,r=o.detail,c=r.target,l=C(r,["target"]);l.type=i;var a=c.id;(null===(n=t.ignoreEvents[a])||void 0===n?void 0:n.has(i))||setTimeout((function(){return y(t,void 0,void 0,(function(){var e,t,n,o,r,s,d,u,v=this;return S(this,(function(f){switch(f.label){case 0:return"block-changed"===i?"index"in l&&"number"==typeof l.index?(null===(s=this.throttledBlockChange)||void 0===s||s.call(this,c,null!==(d=l.index)&&void 0!==d?d:0),setTimeout((function(){var e;null===(e=v.throttledInlineSelectionChange)||void 0===e||e.call(v,new CustomEvent("selectionchange"))}),0),[2]):[2]:[4,c.save()];case 1:return(e=f.sent())?("block-added"===(t={type:i,block:e}).type&&(t.index=l.index),"block-removed"===t.type&&(t.blockId=a),"block-moved"===t.type&&(o=(n=l).fromIndex,r=n.toIndex,t.fromBlockId=a,t.toBlockIndex=r,t.toBlockId=null===(u=this.editor.blocks.getBlockByIndex(o))||void 0===u?void 0:u.id),this.socket.send(this.socketMethodName,t),[2]):[2]}}))}))}),0)}}else console.error("block changed but its not custom event")},this.editor=n,this.socket=o,this.socket.connectionId||(console.error("{connectionId} is not set for EditorJSGroupCollab plugin. Some features might not work"),this.socket.connectionId="random-"+crypto.randomUUID()),this.socketMethodName=null!=i?i:"editorjs-update",this.config=m(m({},{blockChangeThrottleDelay:300}),null!=r?r:{}),this.redactorObserver=new MutationObserver((function(e,n){for(var o=0,i=e;o<i.length;o++){var r=i[o];t.handleMutation(r)}})),this.toolboxObserver=new MutationObserver((function(e,n){var o=e.at(-1);o&&t.handleToolboxMutation(o)})),this.setupThrottledListeners()}return Object.defineProperty(e.prototype,"isListening",{get:function(){return this._isListening},enumerable:!1,configurable:!0}),e.prototype.unlisten=function(){this.socket.off(this.socketMethodName),this.editor.off(this.editorBlockEvent,this.onEditorBlockEvent),this.redactorObserver.disconnect(),this.toolboxObserver.disconnect(),document.removeEventListener("selectionchange",this.throttledInlineSelectionChange),window.removeEventListener("beforeunload",this.onDisconnect,{capture:!0}),this.socket.send(this.socketMethodName,{type:x,connectionId:this.socket.connectionId}),this._isListening=!1},e.prototype.listen=function(){var e,t,n,o,i,r,c,l;this.socket.on(this.socketMethodName,this.onReceiveChange),this.editor.on(this.editorBlockEvent,this.onEditorBlockEvent);var a=null!==(o=null!==(t=null===(e=this.editor)||void 0===e?void 0:e.ui.redactor)&&void 0!==t?t:document.querySelector("#".concat(null===(n=this.editor)||void 0===n?void 0:n.configuration.holder," .").concat(this.EditorCSS.editorRedactor)))&&void 0!==o?o:document.querySelector(".".concat(this.EditorCSS.editorRedactor));this.redactorObserver.observe(a,{childList:!0,attributes:!0,attributeFilter:["class"],subtree:!0});var s=null!==(l=document.querySelector("#".concat(null!==(c=null===(r=null===(i=this.editor)||void 0===i?void 0:i.configuration)||void 0===r?void 0:r.holder)&&void 0!==c?c:""," .").concat(this.EditorCSS.toolbarSettings)))&&void 0!==l?l:document.querySelector(".".concat(this.EditorCSS.toolbarSettings));s?this.toolboxObserver.observe(s,{childList:!0,attributes:!0,attributeFilter:["class"],subtree:!0}):console.error("Could not initialize toolbox observer."),document.addEventListener("selectionchange",this.throttledInlineSelectionChange),window.addEventListener("beforeunload",this.onDisconnect,{capture:!0}),this._isListening=!0},Object.defineProperty(e.prototype,"CSS",{get:function(){return{selected:"cdx-realtime-block--selected",inlineCursor:"cdx-realtime-inline-cursor",inlineSelection:"cdx-realtime-inline-selection",deletePending:"cdx-realtime-block--delete-pending"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EditorCSS",{get:function(){return{baseBlock:"ce-block",focused:"ce-block--focused",selected:"ce-block--selected",editorRedactor:"codex-editor__redactor",blockContent:"ce-block__content",toolbar:"ce-toolbar",toolbarSettings:"ce-settings",toolbarDeleteSetting:"[data-item-name='delete']",table:{row:"tc-row",cell:"tc-cell"}}},enumerable:!1,configurable:!0}),e.prototype.handleMutation=function(e){var t,n,o,i;if("attributes"===e.type){var r=e.target;if(r instanceof HTMLElement){var c=r.classList.contains(this.EditorCSS.selected),l=(r.classList.contains(this.EditorCSS.focused),r.getAttribute(this.blockIdAttributeName));if(l){if((null===(t=this.localBlockStates[l])||void 0===t?void 0:t.has("selected"))!=c){if(null===(n=this.ignoreEvents[l])||void 0===n?void 0:n.has(I))return;null!==(o=(i=this.localBlockStates)[l])&&void 0!==o||(i[l]=new Set),c?this.localBlockStates[l].add("selected"):this.localBlockStates[l].delete("selected"),this.socket.send(this.socketMethodName,{type:I,blockId:l,isSelected:c})}this.localBlockStates[l].size||delete this.localBlockStates[l]}}}},e.prototype.handleToolboxMutation=function(e){var t,n,o,i,r=e.target;if(r instanceof HTMLElement){var c=""===r.innerHTML,l=this.editor.blocks.getCurrentBlockIndex(),a=this.editor.blocks.getBlockByIndex(l);if(a){var s=!1;if(!c){var d=document.querySelector(".".concat(this.EditorCSS.toolbar," ").concat(this.EditorCSS.toolbarDeleteSetting));if(!(d instanceof HTMLElement))return;s=d.classList.contains("ce-popover-item--confirmation")}var u=a.id;if((null===(t=this.localBlockStates[u])||void 0===t?void 0:t.has("deleting"))!=s){if(null===(n=this.ignoreEvents[u])||void 0===n?void 0:n.has(E))return;null!==(o=(i=this.localBlockStates)[u])&&void 0!==o||(i[u]=new Set),s?this.localBlockStates[u].add("deleting"):this.localBlockStates[u].delete("deleting"),this.socket.send(this.socketMethodName,{type:E,blockId:u,isDeletePending:s})}}}},e.prototype.setupThrottledListeners=function(){var e=this;this.throttledInlineSelectionChange=i(this.config.blockChangeThrottleDelay,(function(t){e.isListening&&e.onInlineSelectionChange(t)})),this.throttledBlockChange=i(this.config.blockChangeThrottleDelay,(function(t,n){return y(e,void 0,void 0,(function(){var e,o,i;return S(this,(function(r){switch(r.label){case 0:return this.isListening?(e=t.id,[4,t.save()]):[2];case 1:return(o=r.sent())?(this.applyNeccessaryChanges(t,o),i={type:"block-changed",block:o,index:n},this.isListening?(this.socket.send(this.socketMethodName,i),this.addBlockToIgnoreListUntilNextRender(e,"block-changed"),[2]):[2]):[2]}}))}))}))},e.prototype.getFakeCursor=function(e){var t=e.blockId,n=e.connectionId;if(!t&&!n)return null;var o=t?"='".concat(t,"'"):"",i=n?"='".concat(n,"'"):"",r=document.querySelector("[".concat(this.blockIdAttributeName).concat(o,"] .").concat(this.EditorCSS.blockContent," [").concat(this.inlineFakeCursorAttributeName).concat(i,"]"));return r instanceof HTMLElement?r:null},e.prototype.createFakeCursor=function(e){var t=document.createElement("div");return t.setAttribute(this.inlineFakeCursorAttributeName,e),t.classList.add(this.CSS.inlineCursor),t},e.prototype.getFakeSelections=function(e){return document.querySelectorAll("[".concat(this.blockIdAttributeName).concat(e?"='".concat(e,"'"):"","] .").concat(this.EditorCSS.blockContent," [").concat(this.inlineFakeSelectionAttributeName,"]"))},e.prototype.validateEventDetail=function(e){return"object"==typeof e.detail&&e.detail&&("index"in e.detail&&"number"==typeof e.detail.index||"fromIndex"in e.detail&&"number"==typeof e.detail.fromIndex&&"toIndex"in e.detail&&"number"==typeof e.detail.toIndex)&&"target"in e.detail&&"object"==typeof e.detail.target&&e.detail.target},e.prototype.addBlockToIgnoreListUntilNextRender=function(e,t){var n=this;this.addBlockToIgnorelist(e,t),setTimeout((function(){n.removeBlockFromIgnorelist(e,t)}),0)},e.prototype.addBlockToIgnorelist=function(e,t){this.ignoreEvents[e]||(this.ignoreEvents[e]=new Set),this.ignoreEvents[e].add(t)},e.prototype.removeBlockFromIgnorelist=function(e,t){this.ignoreEvents[e]&&(this.ignoreEvents[e].delete(t),this.ignoreEvents[e].size||delete this.ignoreEvents[e])},e.prototype.getDOMBlockById=function(e){var t=document.querySelector("[".concat(this.blockIdAttributeName,"='").concat(e,"']"));return t instanceof HTMLElement?t:null},e.prototype.getRedactor=function(){var e=document.querySelector(".".concat(this.EditorCSS.editorRedactor));return e instanceof HTMLElement?e:null},e.prototype.getContentAndBlockIdFromNode=function(e){var t,n=this;if(!this.isNodeInsideOfEditor(e))return null;for(var o=e.parentElement,i=function(e){var t;return(null==e?void 0:e.classList.contains(n.EditorCSS.blockContent))&&(null===(t=null==e?void 0:e.parentElement)||void 0===t?void 0:t.classList.contains(n.EditorCSS.baseBlock))&&(null==e?void 0:e.parentElement.hasAttribute(n.blockIdAttributeName))};o&&!i(o);)o=o.parentElement;if(!o)return null;var r=null===(t=o.parentElement)||void 0===t?void 0:t.getAttribute(this.blockIdAttributeName);return r?{contentElement:o,blockId:r}:null},e.prototype.isNodeInsideOfEditor=function(e){var t,n,o,i,r,c,l=null===(o=null===(n=null===(t=this.editor)||void 0===t?void 0:t.ui)||void 0===n?void 0:n.nodes)||void 0===o?void 0:o.redactor;if(l instanceof HTMLElement)return l.contains(e);var a=null===(r=null===(i=this.editor)||void 0===i?void 0:i.configuration)||void 0===r?void 0:r.holder;if(a&&"string"==typeof a)return null===(c=document.getElementById(a))||void 0===c?void 0:c.contains(e);for(var s=e.parentElement;s&&s!==document.body;){var d=s.getAttribute(this.blockIdAttributeName),u=s.classList.contains(this.EditorCSS.baseBlock),v=d&&Boolean(this.editor.blocks.getById(d));if(u&&v)return!0;s=s.parentElement}return!1},e.prototype.getElementXPath=function(e){for(var t=e,n=[];t.parentNode instanceof HTMLElement&&!t.classList.contains(this.EditorCSS.editorRedactor);){var o=t.getAttribute(this.blockIdAttributeName),i=t.localName.toLowerCase();if(o&&(i+="[".concat(this.blockIdAttributeName,"='").concat(o,"']")),t.previousElementSibling){for(var r=t,c=1;r=r.previousElementSibling;)c++;i+=":nth-child(".concat(c,")")}n.unshift(i),t=t.parentNode}return n.unshift(".".concat(this.EditorCSS.editorRedactor)),n.join(" > ")},e.prototype.getNodeRelativeChildIndex=function(e){var t=e.parentElement;if(!t)return null;for(var n=0;n<t.childNodes.length;n++)if(e===t.childNodes[n])return n;return null},e.prototype.applyNeccessaryChanges=function(e,t){var n=this;"table"===e.name&&e.holder.querySelectorAll(".".concat(this.EditorCSS.table.row)).forEach((function(e,o){var i,r=Array.from(e.querySelectorAll(".".concat(n.EditorCSS.table.cell))),c=r.every((function(e){var t;return!(null===(t=e.textContent)||void 0===t?void 0:t.trim())}));if(c){var l=null===(i=t.data)||void 0===i?void 0:i.content;l instanceof Array&&l.splice(o,0,r.map((function(e){return e.textContent})))}}))},e.prototype.calculateRelativeRects=function(e,t,n){var o=n.clientWidth;if(t===o)return e;var i=o<t;if(e.at(0),i);else for(var r=0,c=e;r<c.length;r++)c[r];return[]},e.prototype.createSelectionElement=function(){var e=document.createElement("div");return e.setAttribute(this.inlineFakeSelectionAttributeName,""),e.classList.add(this.CSS.inlineSelection),e},e}();return o.default})()));